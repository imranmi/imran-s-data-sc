<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Imran Ibrahim, Rishan Sanjay, Foo T’suen Wei, Nguyen Hoang Dung and Luo Zheng">
<meta name="dcterms.date" content="2024-08-18">

<title>Imran’s Postgrad repo - Project - Predicting Stock Prices through Time series Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Imran’s Postgrad repo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-exercises-in-r" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Exercises in R</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-exercises-in-r">    
        <li>
    <a class="dropdown-item" href="../../R-ex/R-Ex1/R_Ex1.html">
 <span class="dropdown-text">R Exercise 1 - Analysing PISA’s education survey data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../R-ex/R-Ex2/R_Ex2.html">
 <span class="dropdown-text">R Exercise 2 - 5 Exploratory Data Analyses on Pisa Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../R-ex/R-Ex3/R_Ex3.html">
 <span class="dropdown-text">R Exercise 3 - DataVis Makeover of another student’s work</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../R-ex/R-Ex4/R_Ex4.html">
 <span class="dropdown-text">R Exercise 4 - Be Weatherwise or Otherwise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../R-ex/R-Ex5/R_Ex5.html">
 <span class="dropdown-text">R Exercise 5 - Visual Analytics exercise on Armed conflicts - Initial Draft</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../R-ex/R-Ex6/R_Ex6.html">
 <span class="dropdown-text">R Exercise 6 - Geospatial Analysis1 - Local Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../R-ex/R-Ex7/R_Ex7.html">
 <span class="dropdown-text">R Exercise 7 - Geospatial Analysis2 - Emerging Hot Spot Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../R-ex/R-Ex8/R_Ex8.html">
 <span class="dropdown-text">R Exercise 8 - Geospatial Analysis3 - Spatially Constrained Clustering-ClustGeo method</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../R-ex/R-Ex9/R_Ex9.html">
 <span class="dropdown-text">Group Project Poster - Decoding Chaos - Analysing Armed conflicts in Myammar</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-exercises-in-python" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Exercises in Python</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-exercises-in-python">    
        <li>
    <a class="dropdown-item" href="../../Python-ex/Python-Ex1/Python_Ex1.html">
 <span class="dropdown-text">Python Exercise 1 - Automate the design of a 3-stocks portfolio for a given target return</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Python-ex/Python-Ex2/Python_Ex2.html">
 <span class="dropdown-text">Python Exercise 2 - Designing a 3-stock portfolio for a robo-advisor</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Python-ex/Python-Ex3/Python_Ex3.html">
 <span class="dropdown-text">Python Exercise 3 - Project - Predicting Stock Prices through Time series Analysis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-sas-viya-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">SAS Viya Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-sas-viya-exercises">    
        <li>
    <a class="dropdown-item" href="../../Write-ex/Write-Ex1/Write_Ex1.html">
 <span class="dropdown-text">Assignment 1 - Show me the numbers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Write-ex/Write-Ex2/Write_Ex2.html">
 <span class="dropdown-text">Assignment 2 - Be Customer wise or otherwise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Write-ex/Write-Ex3/Write_Ex3.html">
 <span class="dropdown-text">Project - Loan Default prediction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Write-ex/Write-Ex4/Write_Ex4.html">
 <span class="dropdown-text">Project Poster - Loan Default prediction</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-written-assignments-(fintech" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Written Assignments (Fintech)</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-written-assignments-(fintech">    
        <li>
    <a class="dropdown-item" href="../../Article-ex/Article-Ex1/Article_Ex1.html">
 <span class="dropdown-text">Assignment 1 - Factors that contributed to the rise of Fintech companies</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Article-ex/Article-Ex2/Article_Ex2.html">
 <span class="dropdown-text">Assignment 2 - Banks have changed the way they deploy technology</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Article-ex/Article-Ex3/Article_Ex3.html">
 <span class="dropdown-text">Assignment 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Article-ex/Article-Ex4/Article_Ex4.html">
 <span class="dropdown-text">Assignment 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Article-ex/Article-Ex5/Article_Ex5.html">
 <span class="dropdown-text">Assignment 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Article-ex/Article-Ex6/Article_Ex6.html">
 <span class="dropdown-text">Assignment 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Article-ex/Article-Ex7/Article_Ex7.html">
 <span class="dropdown-text">Assignment 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Article-ex/Article-Ex8/Article_Ex8.html">
 <span class="dropdown-text">Assignment 8</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="../../about.html" title="About Imran" class="quarto-navigation-tool px-1" aria-label="About Imran"><i class="bi bi-house-heart"></i></a>
    <a href="https://github.com/imranmi/imran-s-data-sc" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://www.linkedin.com/in/imran-ibrahim-116a236b" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">1. Introduction</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">2. Methodology</a>
  <ul class="collapse">
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link" data-scroll-target="#data-collection">2.1 Data collection</a></li>
  <li><a href="#data-pre-processing" id="toc-data-pre-processing" class="nav-link" data-scroll-target="#data-pre-processing">2.2 Data Pre-processing</a></li>
  <li><a href="#model-selection-and-implementation" id="toc-model-selection-and-implementation" class="nav-link" data-scroll-target="#model-selection-and-implementation">2.3 Model Selection and Implementation</a></li>
  <li><a href="#parameter-adjustments" id="toc-parameter-adjustments" class="nav-link" data-scroll-target="#parameter-adjustments">2.4 Parameter Adjustments</a></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">2.5 Model Evaluation</a></li>
  <li><a href="#analysis-and-conclusion" id="toc-analysis-and-conclusion" class="nav-link" data-scroll-target="#analysis-and-conclusion">2.6 Analysis and Conclusion</a></li>
  <li><a href="#common-metrics-for-time-series-analyses" id="toc-common-metrics-for-time-series-analyses" class="nav-link" data-scroll-target="#common-metrics-for-time-series-analyses">2.7 Common metrics for Time series analyses</a></li>
  </ul></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models">3. Models</a>
  <ul class="collapse">
  <li><a href="#auto-regressive-intergration-moving-ave-arima" id="toc-auto-regressive-intergration-moving-ave-arima" class="nav-link" data-scroll-target="#auto-regressive-intergration-moving-ave-arima">3.1 Auto-Regressive Intergration Moving Ave (ARIMA)</a></li>
  <li><a href="#long-short-term-memory-lstm" id="toc-long-short-term-memory-lstm" class="nav-link" data-scroll-target="#long-short-term-memory-lstm">3.2 Long Short-Term Memory (LSTM)</a></li>
  <li><a href="#facebook-prophet" id="toc-facebook-prophet" class="nav-link" data-scroll-target="#facebook-prophet">3.3 Facebook Prophet</a></li>
  <li><a href="#arima-lstm-hybrid" id="toc-arima-lstm-hybrid" class="nav-link" data-scroll-target="#arima-lstm-hybrid">3.4 ARIMA &amp; LSTM Hybrid</a></li>
  </ul></li>
  <li><a href="#results-and-analysis" id="toc-results-and-analysis" class="nav-link" data-scroll-target="#results-and-analysis">4. Results and Analysis</a>
  <ul class="collapse">
  <li><a href="#arima" id="toc-arima" class="nav-link" data-scroll-target="#arima">4.1 ARIMA</a></li>
  <li><a href="#lstm" id="toc-lstm" class="nav-link" data-scroll-target="#lstm">4.2 LSTM</a></li>
  <li><a href="#fb-prophet" id="toc-fb-prophet" class="nav-link" data-scroll-target="#fb-prophet">4.3 FB Prophet</a></li>
  <li><a href="#moving-averages-linear-regression-k-nearest-neighbours" id="toc-moving-averages-linear-regression-k-nearest-neighbours" class="nav-link" data-scroll-target="#moving-averages-linear-regression-k-nearest-neighbours">4.4 Moving Averages, Linear Regression &amp; K-Nearest Neighbours</a>
  <ul class="collapse">
  <li><a href="#k-nearest-neighbours-knn" id="toc-k-nearest-neighbours-knn" class="nav-link" data-scroll-target="#k-nearest-neighbours-knn">K-Nearest Neighbours (KNN)</a></li>
  </ul></li>
  <li><a href="#arima-lstm-hybrid-1" id="toc-arima-lstm-hybrid-1" class="nav-link" data-scroll-target="#arima-lstm-hybrid-1">4.5 ARIMA &amp; LSTM HYBRID</a></li>
  <li><a href="#network-models" id="toc-network-models" class="nav-link" data-scroll-target="#network-models">4.6 Network Models</a></li>
  </ul></li>
  <li><a href="#limitations-and-future-considerations" id="toc-limitations-and-future-considerations" class="nav-link" data-scroll-target="#limitations-and-future-considerations">5. Limitations and Future considerations</a>
  <ul class="collapse">
  <li><a href="#model-limitations" id="toc-model-limitations" class="nav-link" data-scroll-target="#model-limitations">5.1 Model Limitations</a></li>
  <li><a href="#data-set-and-hyper-parameter-tuning" id="toc-data-set-and-hyper-parameter-tuning" class="nav-link" data-scroll-target="#data-set-and-hyper-parameter-tuning">5.2 Data set and Hyper parameter tuning</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">6. Conclusion</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Project - Predicting Stock Prices through Time series Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Imran Ibrahim, Rishan Sanjay, Foo T’suen Wei, Nguyen Hoang Dung and Luo Zheng </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 18, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">August 23, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>This study focuses on applying and evaluating various time series analysis models for the prediction of stock prices, with an emphasis on understanding the nuances, behaviour, and potential accuracy of each model. While our study conducts a comparative analysis, its primary purpose is to delve deep into the insights and observations we obtained during the application of these models on the same dataset. Our work revolves around using ARIMA, LSTM, and FB Prophet models to forecast future stock prices of Microsoft (MSFT). This stock was selected based on its high trading volumes and considerable market influence. For our dataset, we chose a period of five years, from June 2018 to June 2023, which covers the period before, during and after the pandemic. While longer time periods were considered, we felt that the market environment and price action during this 5-year period would suffice to represent a varied set of data more meaningful than any recent period in the past.&nbsp; FB Prophet serves as the benchmark tool against which the other models were evaluated, utilizing the Root Mean Squared Error (RMSE) as the primary performance metric. An interesting facet of this investigation was the exploration of a hybrid model approach, combining the strengths of ARIMA and LSTM. This allowed for the examination of both short-term and long-term predictive capabilities of these models, and their effectiveness when combined. Ultimately, this study underscores that there is no one-size-fits-all model for stock price prediction. Each model’s effectiveness depends significantly on various factors such as the length of the forecast period, the nature of the data, and the specific application context.</p>
</section>
<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<p>Predicting stock prices is an ever-present challenge within the financial industry, made more complex by the multitude of factors such as economic and news events, and investor sentiment. In this study, we attempt to bring some clarity by employing several time-series forecasting models: focusing our investigation on Microsoft (MSFT), an important component in the US stock market with high trading volumes. &nbsp;We chose a dataset spanning five years, capturing both the pre- and post-pandemic periods. This gives us a diverse and comprehensive dataset that adds depth to our analysis. Our approach involves the application of several models, namely ARIMA (Autoregressive Integrated Moving Average), LSTM (Long Short-Term Memory), and a novel hybrid approach. The effectiveness of these models is contrasted against FB Prophet, a benchmark tool commonly used in the financial industry. The intent of this study goes beyond merely comparing models. We aim to delve into the intricacies of their operation, understanding their data preprocessing needs, and evaluating their performance using suitable metrics. Through this process, we aim to provide a detailed analysis of each model’s strengths and weaknesses.</p>
<p><u><strong>Business case</strong></u>: In wealth management at banks, relationship managers often provide advice based on a standardized ‘house view’, formulated through a mix of financial modelling, fundamental and technical analysis, and human judgement. This ‘black box’ approach often leads to a lack of transparency concerning the basis and success rates of these investment strategies. This study aims to improve this scenario by exploring the use of time-series models to predict individual stocks prices, thereby enhancing the banks’ ability to provide science-based investment advice. This could potentially lead to more transparent and personalized investment strategies, and ultimately improve customer satisfaction and trust in the investment advice they receive.</p>
</section>
<section id="methodology" class="level1">
<h1>2. Methodology</h1>
<p>In this project, we employ a systematic approach to analysing and predicting stock prices, which involves several steps:</p>
<section id="data-collection" class="level2">
<h2 class="anchored" data-anchor-id="data-collection">2.1 Data collection</h2>
<p>We gathered historical stock price data for Microsoft (MSFT) from Yahoo Finance. Our data spans a period of five years, from June 2018 to June 2023, which includes both pre- and post-pandemic periods.</p>
</section>
<section id="data-pre-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-pre-processing">2.2 Data Pre-processing</h2>
<p>To prepare the data for our models, we carried out several pre-processing steps. These steps may vary between models, but they generally include handling missing data, normalizing or standardizing the data, and potentially detrending or de-seasonalizing the data where necessary.</p>
</section>
<section id="model-selection-and-implementation" class="level2">
<h2 class="anchored" data-anchor-id="model-selection-and-implementation">2.3 Model Selection and Implementation</h2>
<p>We selected several time-series forecasting models for our study, including ARIMA, LSTM, and a novel hybrid approach. These models were implemented using the Python programming language with the help of libraries such as statsmodels for ARIMA, Keras for LSTM, and FB Prophet for our benchmark model. We are also exploring some other models to see if they have any novel results.</p>
</section>
<section id="parameter-adjustments" class="level2">
<h2 class="anchored" data-anchor-id="parameter-adjustments">2.4 Parameter Adjustments</h2>
<p>Each model was fine-tuned to optimize performance. This involved adjusting various parameters specific to each model to minimize forecasting error. For example, for ARIMA, we determined the optimal order parameters (p, d, q) using techniques like the AIC criterion or PACF and ACF plots.</p>
</section>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">2.5 Model Evaluation</h2>
<p>To evaluate the performance of our models, we split our data set into a training set (2018-06-15 to 2023-1-15) and a test set (2023-1-15 to 2023-6-15). The models were trained on the training data and their predictions were compared to the actual prices in the test set. We used several metrics to measure the accuracy of the models’ predictions, including Mean Absolute Error (MAE), Root Mean Square Error (RMSE).</p>
</section>
<section id="analysis-and-conclusion" class="level2">
<h2 class="anchored" data-anchor-id="analysis-and-conclusion">2.6 Analysis and Conclusion</h2>
<p>Finally, we conducted a comparative analysis of the performance of each model. We discussed the strengths and weaknesses of each model, insights gained, and the implications for real-world investment decision-making.</p>
</section>
<section id="common-metrics-for-time-series-analyses" class="level2">
<h2 class="anchored" data-anchor-id="common-metrics-for-time-series-analyses">2.7 Common metrics for Time series analyses</h2>
<p>The below metrics will be used to evaluate our model results.</p>
<p><img src="images/clipboard-1344682259.png" class="img-fluid"></p>
</section>
</section>
<section id="models" class="level1">
<h1>3. Models</h1>
<section id="auto-regressive-intergration-moving-ave-arima" class="level2">
<h2 class="anchored" data-anchor-id="auto-regressive-intergration-moving-ave-arima">3.1 Auto-Regressive Intergration Moving Ave (ARIMA)</h2>
<p>The traditional statistical model we adopted in the time series analysis is the ARIMA model. It is a combination of autoregressive (AR) and moving average (MA). “I” in the middle means that the model employs differencing of raw observations to make the time-series stationary. ARIMA can be used for modeling stationary time series or non-stationary time series that can become stationary through differentiation. Stationary series are those whose expected value and variance do not change over time.</p>
<p>An ARIMA model is defined by its three order parameters, p, d, q. The parameter p represents the number of autoregressive terms or the number of “lag observations”. It determines the outcome of the model by providing lagged data points. The parameter d, known as the degree of differencing, indicates how many times the lagged indicators have been subtracted to achieve data stationarity. The parameter q signifies the number of forecast errors in the model and is often referred to as the size of the moving average window.</p>
<p>The process of building the ARIMA model can be divided into three phases. In the first phase is to check if the time series is stationary by examining ACF, PACF, and Dickey-Fuller tests. The second phase is to choose parameters and the performance of the model would be tested in the third phase.</p>
</section>
<section id="long-short-term-memory-lstm" class="level2">
<h2 class="anchored" data-anchor-id="long-short-term-memory-lstm">3.2 Long Short-Term Memory (LSTM)</h2>
<p>LSTM is a recurrent neural network (RNN) model and is widely adopted in the time series analysis. The main idea behind LSTM cells is to learn the important parts of the sequence seen so far and forget the less important ones. LSTM cells are designed to deal with the problem of “long-term dependence” and the memory capacity of standard recurrent cell is improved by introducing a gate into the cell. In particular, three types of gates are involved in each cell, namely forget gate, memory gate, and output gate. In cells, data can be disposed, filtered, or added for the next cells by using gates. The amount of data entering a cell at a time is referred to as “batch size”. The number of complete runs through the data is known as an “epoch”.</p>
<p>In the stock price prediction, we can put the historical close prices into the model and tune the hyperparameters to optimize the model performance. Some important hyperparameters include units, epochs, optimizer, input shape, batch size etc.</p>
</section>
<section id="facebook-prophet" class="level2">
<h2 class="anchored" data-anchor-id="facebook-prophet">3.3 Facebook Prophet</h2>
<p>Prophet was developed by Facebook as an algorithm for the prediction of time series values for different business applications. Prophet is a useful tool for time series forecasting. It incorporates non-linear trends, as well as yearly, weekly, and daily seasonality patterns, and prides itself on being able to predict holiday effects. It excels in forecasting time series that exhibit significant seasonal variations and possess a substantial historical data spanning multiple seasons.&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>It is an additive model consisting of four components: g(t) is a trend to capture the general trend of the series. s(t) is a seasonality component and h(t) is a Holidays component. The error term εt stands for random fluctuations that cannot be explained by the model.</p>
</section>
<section id="arima-lstm-hybrid" class="level2">
<h2 class="anchored" data-anchor-id="arima-lstm-hybrid">3.4 ARIMA &amp; LSTM Hybrid</h2>
<p>Both ARIMA and LSTM models have their own strengths and weaknesses. ARIMA has difficulties with non-linear time series data whereas neural networks can work with linear and non-linear time series data. However, LSTM requires long training time and parameter selection can be challenging. To leverage the strengths of both models, a hybrid approach is implemented to capitalize on their respective expertise. The aim is to achieve more accurate predictions compared to using either model individually. In this hybrid model, the ARIMA component is applied to capture the trend component, while the LSTM component is utilized to model both the seasonal and residual components of the time series. By combining the two models, it is expected to enhance the overall forecasting performance and capture a broader range of patterns in the data.</p>
<p>Here is a summary of all the adopted models in our project:</p>
<table class="caption-top table">
<caption>Table 1: Model Comparison</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 6%">
<col style="width: 40%">
<col style="width: 15%">
<col style="width: 11%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Name</th>
<th>Concept</th>
<th>Applications</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Statistical model</td>
<td>ARIMA</td>
<td>A model that characterizes time series by the aspects of autoregressive, integrated, and moving average terms.</td>
<td>Analyse and forecast time series data</td>
<td><p>Simple and interpretable.</p>
<p>Accurate in short term prediction</p></td>
<td><p>Limitation in non-linear patterns</p>
<p>Sensitivity in parameter selection</p></td>
</tr>
<tr class="even">
<td>Recurrent neural network (RNN) model</td>
<td>LSTM</td>
<td>Long-Short Term Memory model capable of learning order dependence for sequence prediction issues.</td>
<td>Deep learning, speech recognition, machine translation</td>
<td><p>Capture long-term and non-linear patterns</p>
<p>Do not rely on specific data assumptions</p></td>
<td><p>Computation extensive</p>
<p>Require more data</p>
<p>Less interpretable</p></td>
</tr>
<tr class="odd">
<td>Statistical &amp; machine learning</td>
<td>FB PROPHET</td>
<td>An additive model developed by Facebook, for forecasting time series data. Used best for time series with strong seasonal effects and a long history.</td>
<td>Forecast business results for planning and goal setting.</td>
<td><p>Simple interface</p>
<p>Capture seasonality and patterns</p>
<p>Less data prepossessing</p></td>
<td><p>Limited to univariant forecasting</p>
<p>Less customized</p></td>
</tr>
<tr class="even">
<td>Hybrid Model</td>
<td>ARIMA + LSTM (hybrid)</td>
<td>Hybrid LSTM and ARIMA model combines LSTM’s non-linear capabilities with ARIMA’s ability to capture linear trends.</td>
<td>Time series prediction and integrate non-linear trend</td>
<td><p>Comprehensive</p>
<p>Improve model performance</p>
<p>Adaptability</p></td>
<td><p>Complexity</p>
<p>Further studies required in model architecture</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="results-and-analysis" class="level1">
<h1>4. Results and Analysis</h1>
<section id="arima" class="level2">
<h2 class="anchored" data-anchor-id="arima">4.1 ARIMA</h2>
<p>When using ARIMA, we initially wanted to see how accurate the model could be for predicting longer time frames. For this purpose, we used a Train-test split configuration where our test range would span a 5- month period (2023-1-15 to 2023-6-15). We then checked the data for stationarity using the Dickey-Fuller test. We obtained a p-value of 0.857 which confirmed that the data was not stationary. We performed a pairwise differencing to make this data stationary. The resultant stationarity can be observed visually below, with the differenced data now centred around the mean. We can also confirm this via another Dickey-Fuller test, where we now obtain a revised p-value closer to zero.</p>
<p>When determining the parameters for the AR and MA parts of the model, we plotted the ACF and PACF plots for the differenced data to determine the values of p and q. Here, an ARIMA model of order (1,1,1) seemed reasonable to be used for our Manual-Arima workflow.&nbsp; At the same time, we also used the Auto-Arima function to obtain the optimal (p,d,q) values which had the lowest values of AIC and BIC (Auto-Arima workflow). This recommended an ARIMA model of (4,1,1).&nbsp; We compared both workflows and proceeded on with the Auto-Arima which had scored better in the MAE, MAPE and RSME metrics.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-1812171745.png" class="img-fluid figure-img"></p>
<figcaption>Fig 2: Pairwise Differencing</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-33779334.png" class="img-fluid figure-img"></p>
<figcaption>Fig 3: ACF and PACF</figcaption>
</figure>
</div>
<p>We then applied this model to our test data range (5 months) and obtained predictions as show in the chart below, which seems to predict a “flat” stock price for the next 5 months. This runs contrary to price dynamics for actively traded stocks, where prices are not likely to remain the same daily. Here, we concluded that the ARIMA model could not derive meaningful results when predicting for longer time frames and that longer term forecasting using ARIMA were prone to converging at the mean.&nbsp; The ARIMA model only uses the previous X observations to make a prediction. Furthermore, prediction errors accumulate, and this results in the ARIMA model simply predicting a straight line for longer time frames. We therefore changed our test range to a shorter time frame of 1 month and re-visited the above steps to see the difference. We noted that our RSME score improved to 16.399 from the previous 46.55, and that our model no longer makes a ‘flat’ prediction of prices.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-1221917145.png" class="img-fluid figure-img"></p>
<figcaption>Fig 4: ARIMA results</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-3310989986.png" class="img-fluid figure-img"></p>
<figcaption>Fig 5: Auto Arima Results</figcaption>
</figure>
</div>
<p><strong>This leads us to conclude that the ARIMA model, on its own, would only be suited to make short term price predictions (a few days out). Next, we explore other models which may be better suited for making longer term predictions.</strong></p>
</section>
<section id="lstm" class="level2">
<h2 class="anchored" data-anchor-id="lstm">4.2 LSTM</h2>
<p>For our testing we used LSTM in 2 ways – the first was with “default” settings and the second was with parameter hyper-tuning. The results varied wildly and yielded many interesting insights. Both used the Adaptive Moment Estimation (Adam) optimizer. Although there are many other alternative optimizers, adam was selected not only because it is widely used (and as a result, widely watched), but also because it is specifically designed for training deep learning neural networks. We would have used others such as adagrad, adadelta, RMSprop and the plethora of optimizers out there but time is a factor, and it seems it might stray from our topic at hand.</p>
<p>The “default” LSTM was run with a batch size of 1 and an epoch of 3. The RMSE hovers around 7-9 across runs and although the model was unable to predict precise price points, it accurately predicted trends on when the stock went up and down. (figure below)</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-3575021432.png" class="img-fluid figure-img"></p>
<figcaption>Fig 6: LSTM Model 1 results</figcaption>
</figure>
</div>
<p>The second model, with hyper-tuning, showed much more promise but tended to overfit. It trades robustness for more accuracy. The reverse of the above happened, where stock prices were predicted with a much higher degree of precision, some days a few cents off but overfit. RMSE drops to as low as 1 or even 0.05 (figure of extreme example below). What happens is that the model ends up using the previous day’s close price to predict the next day’s price. If you shift the predictions one day backwards it makes an almost perfect overlay. I propose that the best would be to use hyper-tuning with a bigger range of stocks so that the model can learn more meaningful patterns. Finer tuning of parameters also affects the results as well, and as such further experimentation could be done.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-4233130717.png" class="img-fluid figure-img"></p>
<figcaption>Fig 7: LSTM Model 2 results</figcaption>
</figure>
</div>
</section>
<section id="fb-prophet" class="level2">
<h2 class="anchored" data-anchor-id="fb-prophet">4.3 FB Prophet</h2>
<p>There is not much to mention on our process for using FB Prophet since most of it was straightforward. There was no parameter tuning and such. The Prophet package provides intuitive parameters which are easy to use and specify for trend, seasonality and holiday.</p>
<p>However, to note is that the RMSE of this model is quite high as compared to the LSTM since it tries to give more of a ballpark estimate rather than a precise number. By that standard, if we consider whether the actual number lands within the predicted upper and lower bounds it is more accurate than simply taking it at face value. The RMSE typically floats around 18.8 with a minor deviation past 2 decimal places.</p>
<p>The 3 figures below in order of presentation shows the overall prediction period (“zoomed out”), day-to-day view for predictions (“zoomed in”), and finally the table of numbers for a more numerical view of the predictions. One thing to note is that each red dot is a single day.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-1749656896.png" class="img-fluid figure-img"></p>
<figcaption>Fig 8: FB Prophet Predictions</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-1789711803.png" class="img-fluid figure-img"></p>
<figcaption>Fig 9: FB Prophet Prediction Range</figcaption>
</figure>
</div>
</section>
<section id="moving-averages-linear-regression-k-nearest-neighbours" class="level2">
<h2 class="anchored" data-anchor-id="moving-averages-linear-regression-k-nearest-neighbours">4.4 Moving Averages, Linear Regression &amp; K-Nearest Neighbours</h2>
<p>As part of our study, we also explored the use of other models commonly used in trading. Moving averages and Linear regression form the basis for commonly used Technical Analysis indicators like Exponential Moving Averages, Bollinger bands and Linear Regression Channels. We applied the same dataset and specified a 75-25% train-test split.</p>
<p><strong>Moving averages</strong> are widely used to smooth out fluctuations and identify trends in stock prices. They calculate the average value of a stock’s price over a specified period and are commonly used to generate buy or sell signals. Our moving average model drew a RMSE score of 38.46 but was not able to adjust to sudden shifts in trends, opting for an average between the two price boundaries.</p>
<p><strong>Linear regression</strong> is a statistical technique used to model the relationship between a dependent variable (stock price) and one or more independent variables (time). In stock price prediction, linear regression could be used to fit a straight line to historical data, capturing the overall trend. However, our Linear Regression model seemed to fare worse than our Moving Average model, with an RMSE score of 89.25. The model was only able to project future values based on a fitted linear trendline. While Linear Regression can be simple to use and intuitive, it fails to account for more complex, non-linear trends. Furthermore, it assumes that the relationship between the dependent and independent variables remain constant.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-2394044264.png" class="img-fluid figure-img"></p>
<figcaption>Fig 10: MA predictions</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-3046975556.png" class="img-fluid figure-img"></p>
<figcaption>Fig 11: Linear Regression Predictions</figcaption>
</figure>
</div>
<section id="k-nearest-neighbours-knn" class="level3">
<h3 class="anchored" data-anchor-id="k-nearest-neighbours-knn">K-Nearest Neighbours (KNN)</h3>
<p>K-nearest neighbour is a commonly used Machine Learning algorithm used for classification and regression tasks in various fields including finance. In the context of stock price prediction, we wanted to explore if the KNN model could be used to predict future prices based on the historical prices of K nearest neighbours. While KNN is more commonly used for classification tasks, it could also be applied to regression problems. &nbsp;Our KNN model fared better with an RMSE score of 28.65 but was not able to pick up on any trends in future prices.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-548941481.png" class="img-fluid figure-img"></p>
<figcaption>Fig 12: KNN Model Results</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-3179964704.png" class="img-fluid figure-img"></p>
<figcaption>Fig 13: LSTM Baseline Model results</figcaption>
</figure>
</div>
<p><strong>We concluded that the 3 models performed worse that our LSTM base model, leading us to conclude that they are unable to capture temporal dynamics and patterns inherent in stock price data as effectively as other time series forecasting models.</strong></p>
</section>
</section>
<section id="arima-lstm-hybrid-1" class="level2">
<h2 class="anchored" data-anchor-id="arima-lstm-hybrid-1">4.5 ARIMA &amp; LSTM HYBRID</h2>
<p>The dominant model is in the hybrid is LSTM, as the ARIMA model does not have enough lags to predict the long-term modelling conditions. To improve our model, we have considered additional features from technical analysis such as Bollinger Bands, but ARIMA cannot incorporate those features as it lacks feature selection.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-4010334282.png" class="img-fluid figure-img"></p>
<figcaption>Fig 14: Combined Predictions</figcaption>
</figure>
</div>
</section>
<section id="network-models" class="level2">
<h2 class="anchored" data-anchor-id="network-models">4.6 Network Models</h2>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-1538736686.png" class="img-fluid figure-img"></p>
<figcaption>Fig 15: Simple Network Model</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-4083043596.png" class="img-fluid figure-img"></p>
<figcaption>Fig 16: Ideal Network model (Future scope)</figcaption>
</figure>
</div>
<p>Network Models aid in modelling relationships between varioud stocks. The key advantage of network modelling is capturing complex relationships between various stocks through network dynamics (opinion, adoption, decision), and this would aid in predicting trends through various similarities such as Eigen Vector Similarity, Jaccard Similarity etc. These models would boost the accuracy of predictions as features generated here can be used for our LSTM models. While the network we generated was simple and able to model stocks closest to and most different from MSFT for hedging, a more complex model can build more features and explore relationships such as Key Opinion Leader Stocks for systemic importance, Diversity Centrality to enable diversified portfolios etc.</p>
</section>
</section>
<section id="limitations-and-future-considerations" class="level1">
<h1>5. Limitations and Future considerations</h1>
<section id="model-limitations" class="level2">
<h2 class="anchored" data-anchor-id="model-limitations">5.1 Model Limitations</h2>
<p>The ARIMA Model is limited by the number of lags available in the equation. This makes feature selection inherently impossible. Additionally, many of our other models such as the KNN were found to not capture information on the time series. LSTM while being the best performing model, is extremely computationally intense.</p>
</section>
<section id="data-set-and-hyper-parameter-tuning" class="level2">
<h2 class="anchored" data-anchor-id="data-set-and-hyper-parameter-tuning">5.2 Data set and Hyper parameter tuning</h2>
<p>While prediction on just the time series trend may give us some information, considering more features such as the technical analysis or fundamental analysis would improve our results considerably. To model complex relationships, we could consider network analysis as well as building more technical analysis indicators as features in our model (as we have in our hybrid model)</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>6. Conclusion</h1>
<p>Our study aimed to evaluate multiple models for time series analysis against MSFT and our findings reveal that there is no one-size-fits-all model for stock price prediction. Exploring conventional and unconventional time series models, we found each model has its strengths and weaknesses, and their effectiveness depends on various factors such as the length of the forecast period and the nature of the data. Additionally, the novel LSTM ARIMA hybrid model considered is completed dominated by the LSTM results due to ARIMA not having feature selection and its inability to capture nonlinear trends/features. Hence, we propose that the LSTM model, will yield the best results but highlight that it is computationally expensive. Further, considering network modelling to capture features and additional data considerations such as including technical/fundamental indicators can improve the model’s performance drastically. By utilizing these models, wealth management institutions can enhance their ability to provide science-based investment advice, leading to more transparent and personalized investment strategies for improved customer satisfaction and trust.</p>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-134442895.png" class="img-fluid figure-img"></p>
<figcaption>Fig 17: ADF test before differencing</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-542543060.png" class="img-fluid figure-img"></p>
<figcaption>Fig 18: ADF test after differencing</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-2562649165.png" class="img-fluid figure-img"></p>
<figcaption>Fig 19: Auto ARIMA results</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-1153314565.png" class="img-fluid figure-img"></p>
<figcaption>Fig 20: Auto ARIMA Results</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-2220621537.png" class="img-fluid figure-img"></p>
<figcaption>Fig 21: Additional Technical Indicators used as features in the hybrid model.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/clipboard-70215998.png" class="img-fluid figure-img"></p>
<figcaption>Fig 22: Prophet Results</figcaption>
</figure>
</div>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>Fernando, J. (2023). Moving Average (MA): Purpose, Uses, Formula, and Examples. <em>Investopedia</em>. <a href="https://www.investopedia.com/terms/m/movingaverage.asp" class="uri">https://www.investopedia.com/terms/m/movingaverage.asp</a></p>
<p>Beers, B. (2023). What is Regression? Definition, Calculation, and Example. <em>Investopedia</em>. <a href="https://www.investopedia.com/terms/r/regression.asp" class="uri">https://www.investopedia.com/terms/r/regression.asp</a></p>
<p>Harrison, O. (2019, July 14). Machine Learning Basics with the K-Nearest Neighbors Algorithm. <em>Medium</em>. <a href="https://towardsdatascience.com/machine-learning-basics-with-the-k-nearest-neighbors-algorithm-6a6e71d01761" class="uri">https://towardsdatascience.com/machine-learning-basics-with-the-k-nearest-neighbors-algorithm-6a6e71d01761</a></p>
</section>
<section id="section" class="level1">
<h1></h1>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>